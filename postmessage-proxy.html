<!DOCTYPE html>
<meta charset="utf-8">
<title>PostMessage Proxy</title>
<p>You should not see this text.</p>
<script src="postmessage-proxied-xhr.js"></script>
<script>
var SimpleChannel = PostMessageProxiedXHR.utils.SimpleChannel;

if (window.parent !== window) {
  var channel = SimpleChannel(window.parent, "*", function(data) {
    switch (data.cmd) {
      case "send":
      // TODO: Validate arguments.
      var req = new XMLHttpRequest();
      req.open(data.method, data.url);
      req.onreadystatechange = function() {
        channel.send({
          cmd: "readystatechange",
          readyState: req.readyState,
          status: req.status,
          statusText: req.statusText,
          responseText: req.responseText
        });
      };
      req.send(data.body || null);
      break;
    }
  });
  channel.send({cmd: "ready"});
}
</script>
