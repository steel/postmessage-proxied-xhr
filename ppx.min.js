var PPX=function(){function c(a,b,c){if(!b.allowOrigin)return c.error("CORS is unsupported at that path."),!1;if(b.allowOrigin!="*"&&a.origin!=b.allowOrigin){c.error("message from invalid origin: "+a.origin);return}return!0}function d(a){return{allowOrigin:a.getResponseHeader("Access-Control-Allow-Origin")}}function e(a,c,d){function e(){return a.postMessage?a:a.contentWindow}function g(a){if(a.source!=e())return;var c=b.decode(a.data);"__simpleChannelError"in c?f.onError(c.__simpleChannelError,a.origin):f.onMessage(c,a.origin)}var f={onMessage:c,onError:d||function(a){window.console&&window.console.error&&window.console.error(a)},destroy:function(){b.off(window,"message",g),a=null,c=null},send:function(a){e().postMessage(b.encode(a),"*")},error:function(a){e().postMessage(b.encode({__simpleChannelError:a}),"*")}};return b.on(window,"message",g),f}var a={requestHeaders:["Accept","Content-Type"],requestMethods:["GET","POST","HEAD"],requestContentTypes:["application/x-www-form-urlencoded","multipart/form-data","text/plain"]},b={warn:function(a){window.console&&window.console.warn&&window.console.warn(a)},absolutifyURL:function(a){var b=document.createElement("a");return b.setAttribute("href",a),b.href},on:function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},off:function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)},encode:function(a){var b=[];for(var c in a)b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")},decode:function(a){return b.parseUri("?"+a).queryKey},isSameOrigin:function(a,c){return a=b.parseUri(a),c=b.parseUri(c),a.protocol==c.protocol&&a.authority==c.authority},map:function(a,b){var c=[];for(var d=0;d<a.length;d++)c.push(b(a[d]));return c},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},parseUri:function(a){var c=b.parseUriOptions,d=c.parser[c.strictMode?"strict":"loose"].exec(a),e={},f=14;while(f--)e[c.key[f]]=d[f]||"";return e[c.q.name]={},e[c.key[12]].replace(c.q.parser,function(a,b,d){b&&(e[c.q.name][b]=decodeURIComponent(d))}),e},parseUriOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},inArray:function(a,b,c){var d,e=Array.prototype.indexOf;if(b){if(e)return e.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1}};return{version:"0.1",utils:b,config:a,startServer:function(f){f=f||{};var g=f.window||window.parent,h=e(g,function(e,g){if(e.cmd=="send"){var i=new XMLHttpRequest;e.origin=g,e.headers=b.decode(e.headers);if(!b.isSameOrigin(window.location.href,e.url)){h.error("url does not have same origin: "+e.url);return}if(b.inArray(e.method,a.requestMethods)==-1){h.error("not a simple request method: "+e.method);return}i.open(e.method,e.url),i.onreadystatechange=function(){if(i.readyState==2){var a=d(i);f.modifyAccessControl&&f.modifyAccessControl(a,e);if(!c(e,a,h)){i.abort();return}}h.send({cmd:"readystatechange",readyState:i.readyState,status:i.status,statusText:i.statusText,responseText:i.responseText,responseHeaders:i.getAllResponseHeaders()})};var j=e.headers["Content-Type"];if(j&&b.inArray(j,a.requestContentTypes)==-1){h.error("invalid content type for a simple request: "+j);return}for(var k in e.headers)if(b.inArray(k,a.requestHeaders)==-1){if(k!="X-Requested-With"){h.error("header '"+k+"' is not allowed.");return}}else i.setRequestHeader(k,e.headers[k]);i.setRequestHeader("X-Original-Origin",e.origin),i.send(e.body||null)}});h.send({cmd:"ready"})},buildClientConstructor:function(a){return function c(){function j(){f&&(f.destroy(),f=null),g&&(document.body.removeChild(g),g=null)}var c,d,f,g,h={},i="",k={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4,readyState:0,status:0,statusText:"",responseText:"",open:function(a,b){c=a,d=b,k.readyState=k.OPENED,k.onreadystatechange&&k.onreadystatechange()},setRequestHeader:function(a,b){h[a]=b},getAllResponseHeaders:function(){return i},abort:function(){g&&(j(),k.readyState=k.DONE,k.onreadystatechange&&k.onreadystatechange(),k.readyState=k.UNSENT)},send:function(l){if(k.readyState==k.UNSENT)throw new Error("request not initialized");g=document.createElement("iframe"),f=e(g,function(a){switch(a.cmd){case"ready":f.send({cmd:"send",method:c,url:b.absolutifyURL(d),headers:b.encode(h),body:l||""});break;case"readystatechange":k.readyState=parseInt(a.readyState),k.status=parseInt(a.status),k.statusText=a.statusText,k.responseText=a.responseText,i=a.responseHeaders,k.readyState==4&&j(),k.onreadystatechange&&k.onreadystatechange()}},function(a){b.warn(a),k.responseText=a,k.readyState=k.DONE,j(),k.onreadystatechange&&k.onreadystatechange()}),g.setAttribute("src",b.absolutifyURL(a)),g.style.display="none",document.body.appendChild(g)}};return k}}}}();